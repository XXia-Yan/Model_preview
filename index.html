<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>æ¨¡åž‹æŸ¥çœ‹ä¸Žäº¤äº’é‡‡é›†</title>
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
  <style>
    body { margin: 0; }
    model-viewer { width: 100vw; height: 100vh; }
  </style>
</head>
<body>
  <model-viewer id="viewer"
    src="models/model001.glb"
    auto-rotate
    camera-controls
    shadow-intensity="1">
  </model-viewer>

  <script>
    const viewer = document.getElementById('viewer');
    const endpoint = "http://180.76.171.253:6000/log"; // ðŸ‘ˆ ä½ çš„å…¬ç½‘ç©¿é€åœ°å€

    const sendEvent = (type, data) => {
      fetch(endpoint, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          type,
          timestamp: Date.now(),
          model: viewer.getAttribute("src"),
          ...data
        })
      }).catch(err => console.error("ä¸ŠæŠ¥å¤±è´¥:", err));
    };

    // ç›‘å¬ç›¸æœºå˜åŒ–ï¼ˆæ—‹è½¬ã€ç¼©æ”¾ï¼‰
    viewer.addEventListener("camera-change", () => {
      const cam = viewer.getCameraOrbit();
      sendEvent("camera-change", {
        theta: cam.theta,
        phi: cam.phi,
        radius: cam.radius,
        fov: viewer.getFieldOfView()
      });
    });

    // é¡µé¢å¸è½½å‰å‘é€åœç•™æ—¶é—´
    const startTime = Date.now();
    window.addEventListener("beforeunload", () => {
      const duration = Date.now() - startTime;
      sendEvent("page-leave", { duration });
    });
  </script>
</body>
</html>
